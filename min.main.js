const ratedContainer=document.querySelector(".top-rated"),movieContainer=document.querySelector(".menu-movies"),menuOption=document.querySelectorAll(".menu_option"),upcoming=document.querySelector(".upcoming"),popular=document.querySelector(".popular"),toprated=document.querySelector(".toprated"),search=document.querySelector(".search"),watchListPage=document.querySelector(".watch-list");let watchList=JSON.parse(localStorage.getItem("watchList"))||[];const paginationContainer=document.querySelector(".pagination"),body=document.body,apiKey="7ee97ee3a7d032fcfe7002b6b8a871e0",baseUrl="https://api.themoviedb.org/3",imageUrl="https://image.tmdb.org/t/p/original";let activeType="popular",currentPage=1;for(let e=1;e<=500;e++)paginationContainer.innerHTML+=`\n  <li class='page'>${e}</li>\n  \n  `;async function renderMoviesByType(e){let t=await fetch(`${baseUrl}/movie/${e}?api_key=${apiKey}&page=${currentPage}`),{results:i}=await t.json();document.querySelector(".menu_option.popular").classList.contains("active")?activeType="popular":document.querySelector(".menu_option.toprated").classList.contains("active")?activeType="top_rated":document.querySelector(".menu_option.upcoming").classList.contains("active")&&(activeType="upcoming"),movieContainer.innerHTML=i.map((({poster_path:e,id:t})=>`\n            <div id=${t} class="menu-movies_item movie">\n              <img src="${imageUrl}${e}" alt="" width="100px">\n            </div>\n          `)).join("");for(let e of movies)e.addEventListener("click",(()=>{getMovieInfo(e.id)}))}const getTopRatedMovies=async()=>{const e=await fetch(`${baseUrl}/movie/top_rated?api_key=${apiKey}`),{results:t}=await e.json();ratedContainer.innerHTML=t.map((({poster_path:e,id:t},i)=>`\n      <div id=${t} class="top-rated-movie movie">\n        <img src="${imageUrl}${e}" alt="" width="144px">\n        <h1 class="movie-number">${i+1}</h1>\n      </div>\n    `)).join("")},getMovies=async()=>{const e=await fetch(`${baseUrl}/movie/popular?api_key=${apiKey}&page=1`),{results:t}=await e.json();movieContainer.innerHTML=t.map((({poster_path:e,id:t})=>`\n      <div id=${t} class="menu-movies_item movie">\n        <img src="${imageUrl}${e}" alt="" width="100px">\n      </div>\n    `)).join("");for(let e of movies)e.addEventListener("click",(()=>{getMovieInfo(e.id)}));menuOption.forEach((e=>{e.addEventListener("click",(()=>{menuOption.forEach((e=>e.classList.remove("active"))),e.classList.add("active")}))}))},getMovieInfo=async e=>{const t=await fetch(`${baseUrl}/movie/${e}?api_key=${apiKey}`),i=await t.json();body.innerHTML=`\n  \n  <div id="app-detail">\n      <div class="nav">\n        <a href='index.html'> <i class="fa fa-angle-left"></i></a>\n        <p>Detail</p>\n        <div><i id=${i.id} class="fa fa-bookmark bookmark"></i></div>\n      </div>\n\n      <div class="movie_container">\n        <img\n          src="https://image.tmdb.org/t/p/original/${i.backdrop_path}"\n          alt=""\n        />\n      </div>\n      <div class="movie_title">\n        <img\n          src="https://image.tmdb.org/t/p/original/${i.poster_path}"\n          alt=""\n          width="95px"\n        />\n        <p>${i.title}</p>\n      </div>\n      <div class="movie_details">\n        <i class="fa fa-calendar"></i>\n        <p>${i.release_date.slice(0,4)}</p>\n        <p>|</p>\n        <i class="fa fa-clock"></i>\n        <p>${i.runtime} Minutes</p>\n        <p>|</p>\n        <i class="fa fa-ticket"></i>\n        <p>${i.genres[0].name}</p>\n      </div>\n\n      <div class="movie_nav">\n        <ul>\n          <li class="movie_nav_option about-movie active">About Movie</li>\n          <li class='movie_nav_option reviews'>Reviews</li>\n        </ul>\n\n        <div class='detail-container'>\n       ${i.overview}\n        </div>\n      </div>\n    </div>\n  `;const a=document.querySelector(".reviews");document.querySelector(".about-movie").addEventListener("click",(async()=>{const t=await fetch(`${baseUrl}/movie/${e}?api_key=${apiKey}`),i=await t.json(),a=document.querySelector(".detail-container");a.innerHTML="",a.innerHTML+=`\n    <p>${i.overview}</p>\n    </div>\n    `})),a.addEventListener("click",(async()=>{const t=await fetch(`${baseUrl}/movie/${e}/reviews?api_key=${apiKey}`),{results:i,total_pages:a}=await t.json(),n=document.querySelector(".detail-container");i.map((({author:e,content:t})=>{n.innerHTML="",n.innerHTML+=`\n    <div class='review-container'>\n    <div class='review_person'>\n    <i class='fa fa-user'></i>\n    <p style='font-weight:bold;color:cyan'>${e}</p>\n    </div>\n    <p>${0==a?"No reviews yet":t}</p>\n    </div>\n    `}))}));const n=document.querySelector(".bookmark");if(watchList.includes(i.id)){document.getElementById(`${i.id}`).classList.add("selected")}const s=document.querySelectorAll(".movie_nav_option");s.forEach((e=>{e.addEventListener("click",(()=>{s.forEach((e=>e.classList.remove("active"))),e.classList.add("active")}))})),n.addEventListener("click",(function(){watchList.includes(i.id)?watchList.includes(i.id)&&((e=>{watchList=watchList.filter((t=>t!=e)),localStorage.setItem("watchList",JSON.stringify(watchList))})(i.id),n.classList.remove("selected"),localStorage.setItem("watchList",JSON.stringify(watchList))):(watchList.unshift(i.id),localStorage.setItem("watchList",JSON.stringify(watchList)),n.classList.add("selected"))}))};function switchSelected(e){document.querySelectorAll(".nav-icon").forEach((t=>{t.querySelector("i").classList.remove("selected"),t.querySelector("p").classList.remove("selected");const i=e.querySelector("i"),a=e.querySelector("p");i.classList.add("selected"),a.classList.add("selected")}))}const navElements=document.querySelectorAll(".nav-icon");function searchFocus(){document.querySelector(".input").focus()}navElements.forEach((e=>{e.addEventListener("click",(()=>{switchSelected(e)}))}));const input=document.querySelector(".input"),searchMovies=async e=>{if("Enter"==e.key){const e=document.querySelector(".search-movies");e.classList.remove("hidden");const t=await fetch(`\n  https://api.themoviedb.org/3/search/movie?api_key=7ee97ee3a7d032fcfe7002b6b8a871e0&query=${input.value}`),{results:i}=await t.json();e.innerHTML=i.map((({poster_path:e,id:t})=>`\n  \n  <img id=${t} class='movie' src="${imageUrl}${e}" alt="" width="100px"/>\n  \n\n  `)).join("")}for(let e of movies)e.addEventListener("click",(()=>{getMovieInfo(e.id)}))},getWatchList=async()=>{body.innerHTML='\n    <div id="watch-list_app">\n    <div class="watch-list_nav">\n      <a href="index.html"> <i class="fa fa-angle-left"></i></a>\n      <p>Watch list</p>\n    </div>\n\n    <div class="saved-movies"></div>\n  </div>\n\n    ';let e=document.querySelector(".saved-movies");watchList.map((async t=>{const i=await fetch(`${baseUrl}/movie/${t}?api_key=${apiKey}`),a=await i.json();e.innerHTML+=`\n    <div id=${a.id} class="saved_item movie">\n    <img src="${imageUrl}${a.poster_path}" alt="" width="95px">\n    \n        <div class="saved-movies_info">\n          <p style='margin-bottom:14px' class='saved-movies_title'>${a.title} <i id=${a.id} class='fa fa-trash delete-btn'></i></p>\n          <div class="rating info">\n            <i style=${a.vote_average<6?"color:red":"color:yellow"} class="fa fa-star"></i>\n            <p style=${a.vote_average<6?"color:red":"color:yellow"} >${a.vote_average.toPrecision(2)}</p>\n          </div>\n          <div class="genre info">\n            <i class="fa fa-ticket"></i>\n            <p>${a.genres[0].name}</p>\n          </div>\n          <div class="release info">\n            <i class="fa fa-calendar"></i>\n            <p>${a.release_date.slice(0,4)}</p>\n          </div>\n          <div class="duration info">\n            <i class="fa fa-clock"></i>\n            <p>${a.runtime} Minutes</p>\n          \n          </div>\n        </div>\n      </div>\n    `;document.querySelectorAll(".delete-btn").forEach((e=>{e.addEventListener("click",(()=>{const t=e.id;n(t)}))}));const n=e=>{watchList=watchList.filter((t=>t!=e)),localStorage.setItem("watchList",JSON.stringify(watchList)),getWatchList()}}));for(let e of movies)e.addEventListener("click",(()=>{getMovieInfo(e.id)}))};let movies=document.getElementsByClassName("movie");const pages=document.querySelectorAll(".page");pages.forEach((e=>{e.addEventListener("click",(()=>{pages.forEach((e=>e.classList.remove("selected-page"))),e.classList.add("selected-page")}))}));const changePage=async(e,t=activeType)=>{currentPage=e.target.innerText;const i=await fetch(`${baseUrl}/movie/${t}?api_key=${apiKey}&page=${currentPage}`),{results:a}=await i.json();movieContainer.innerHTML=a.map((({poster_path:e,id:t})=>`\n      <div id=${t} class="menu-movies_item movie">\n        <img src="${imageUrl}${e}" alt="" width="100px">\n      </div>\n    `)).join("");for(let e of movies)e.addEventListener("click",(()=>{getMovieInfo(e.id)}))};getTopRatedMovies(),getMovies(),watchListPage.addEventListener("click",getWatchList),upcoming.addEventListener("click",(()=>renderMoviesByType("upcoming"))),toprated.addEventListener("click",(()=>renderMoviesByType("top_rated"))),popular.addEventListener("click",(()=>renderMoviesByType("popular"))),input.addEventListener("keypress",searchMovies),search.addEventListener("click",searchFocus),pages.forEach((e=>e.addEventListener("click",changePage)));